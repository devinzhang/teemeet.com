<?php

/**
 * Implementation of hook_init().
 */
function teemeet_heartbeat_init() {
  drupal_add_css(drupal_get_path('module', 'teemeet_heartbeat') . '/teemeet_heartbeat.css');
}

include_once('teemeet_heartbeat.features.inc');

/**
 * Implementation of hook_heartbeat_register_access_types().
 */
function teemeet_heartbeat_heartbeat_register_access_types() {
  return array(
    // Site activity stream is kind of a copy of HeartbeatPublic.
    // It is only to show you how it's done.
    0 => array(
      'name' => 'Site user activity',
      'class' => 'SiteUserActivity',
      'path' => 'site_user_activity.inc',
      'module' => 'teemeet_heartbeat',
      'access' => TRUE
    ),
  );
}

function teemeet_heartbeat_heartbeat_theme_alter(&$messages, HeartbeatAccess $stream) {

  foreach ($messages as $key => $message) {
    /*
	print "<pre>";
	print_r($message);
	print "</pre>";
	exit;
  */
    $messages[$key]->display_time = FALSE;

    if ($message->message_id == 'custom_user_signup_event') {
      $timeago = '<span class="activity-time">' . t('@time ago', array('@time' => format_interval(($_SERVER['REQUEST_TIME'] - $message->timestamp), 1))) . '</span>';

      $message->message = $message->variables['@picture'];
      $message->message .= '<div class="teemeet-message-front">';
      $message->message .= $message->variables['@user'] . $timeago . '<br/>';
      $message->message .= 'is going to a meetup with ' . $message->variables['@group'];
      $message->message .= '</div>';
    }
  }

}
